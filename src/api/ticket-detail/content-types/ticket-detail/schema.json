{
  "kind": "collectionType",
  "collectionName": "ticket_details",
  "info": {
    "singularName": "ticket-detail",
    "pluralName": "ticket-details",
    "displayName": "ticket-detail",
    "description": ""
  },
  
  "options": {
    "draftAndPublish": true
  },
  "pluginOptions": {},
  "attributes": {
    "ticket": {
      "type": "relation",
      "relation": "manyToOne",
      "target": "api::ticket.ticket",
      "inversedBy": "ticket_details"
    },
    "product": {
      "type": "relation",
      "relation": "manyToOne",
      "target": "api::product.product"
    },
    "variant": {
      "type": "string",
      "required": false,
      "description": "Variant name/id if ticket is for specific product variant"
    },
    "ticket_code": {
      "type": "string",
      "required": true,
      "unique": true,
      "description": "Generated unique ticket code (e.g., TK-20240101-0001)"
    },
    "unique_token": {
      "type": "string",
      "required": true,
      "unique": true,
      "description": "Unique token for QR code generation and verification"
    },
    "qr_code": {
      "type": "text",
      "description": "Base64 encoded QR code image"
    },
    "qr_code_encrypted": {
      "type": "text",
      "description": "Encrypted unique_token for additional security"
    },
    "verification_status": {
      "type": "enumeration",
      "enum": [
        "unused",
        "verified",
        "invalid",
        "duplicate"
      ],
      "default": "unused",
      "description": "Status of ticket verification"
    },
    "payment_status": {
      "type": "enumeration",
      "enum": [
        "pending",
        "paid",
        "refunded",
        "cancelled"
      ],
      "default": "pending",
      "description": "Payment status of ticket"
    },
    "buyer_email": {
      "type": "email",
      "required": true,
      "description": "Email of ticket buyer"
    },
    "buyer_phone": {
      "type": "string",
      "required": true,
      "description": "Phone number of ticket buyer"
    },
    "buyer_name": {
      "type": "string",
      "required": true,
      "description": "Name of ticket buyer"
    },
    "verified_at": {
      "type": "datetime",
      "description": "Timestamp when ticket was verified"
    },
    "verified_by": {
      "type": "relation",
      "relation": "manyToOne",
      "target": "plugin::users-permissions.user",
      "description": "Admin/staff who verified the ticket"
    },
    "notes": {
      "type": "text",
      "description": "Additional notes about ticket (e.g., refund reason)"
    },
    "is_bypass": {
      "type": "boolean",
      "default": false,
      "description": "True if ticket is created without payment (bypass/send invitation)"
    },
    "recipient_name": {
      "type": "string",
      "required": true
    },
    "identity_type": {
      "type": "enumeration",
      "enum": [
        "KTP",
        "SIM",
        "Lainnya"
      ],
      "required": true
    },
    "identity_number": {
      "type": "string",
      "required": true
    },
    "whatsapp_number": {
      "type": "string",
      "required": true
    },
    "recipient_email": {
      "type": "email",
      "required": true
    },
    "barcode": {
      "type": "string",
      "unique": true,
      "required": true
    },
    "status": {
      "type": "enumeration",
      "enum": [
        "active",
        "used",
        "cancelled"
      ],
      "default": "active",
      "required": true
    },
    "transaction_ticket": {
      "type": "relation",
      "relation": "manyToOne",
      "target": "api::transaction-ticket.transaction-ticket",
      "inversedBy": "ticket_details"
    },
    "user": {
      "type": "relation",
      "relation": "manyToOne",
      "target": "plugin::users-permissions.user"
    }
  }
}
